<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image Paste & Canvas Editor</title>
  <style>
    body {
      font-family: sans-serif;
    }
    #canvasContainer {
      position: relative;
      width: 1200px;
      height: 720px;
      border: 2px solid black;
      margin-bottom: 20px;
    }
    canvas {
      display: block;
    }
    #newsCanvas {
      border: 2px solid black;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
    }
  </style>
</head>
<body>

<div id="canvasContainer">
  <canvas id="canvas" width="1200" height="720"></canvas>
</div>

<input type="text" id="headlineInput" size="100" placeholder="Enter headline" />
<button id="generateButton">Generate Final Image</button>
<canvas id="newsCanvas" width="1080" height="1080"></canvas>

<script>
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const newsCanvas = document.getElementById('newsCanvas');
  const newsCtx = newsCanvas.getContext('2d');
  const headlineInput = document.getElementById('headlineInput');
  const generateButton = document.getElementById('generateButton');

  let image = null;

  // ðŸ‘‡ Handle image paste from clipboard
  document.addEventListener('paste', (e) => {
    const items = (e.clipboardData || window.clipboardData).items;
    for (let i = 0; i < items.length; i++) {
      if (items[i].type.indexOf('image') !== -1) {
        const blob = items[i].getAsFile();
        const reader = new FileReader();
        reader.onload = function (event) {
          image = new Image();
          image.onload = function () {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
          };
          image.src = event.target.result;
        };
        reader.readAsDataURL(blob);
      }
    }
  });

  // ðŸ‘‡ Draw final image on newsCanvas
  generateButton.addEventListener('click', () => {
    if (!image) return alert("Paste an image first!");

    newsCtx.clearRect(0, 0, newsCanvas.width, newsCanvas.height);
    
    // Draw white background
    newsCtx.fillStyle = 'white';
    newsCtx.fillRect(0, 0, newsCanvas.width, newsCanvas.height);

    // Draw image from first canvas
    const tempImage = new Image();
    tempImage.onload = () => {
      newsCtx.drawImage(tempImage, 25, 70, 1030, 611); // position image
      newsCtx.strokeStyle = 'white'; // white border
      newsCtx.lineWidth = 1;
      newsCtx.strokeRect(25, 70, 1030, 611); // white border around image

      // Draw text
      const headline = headlineInput.value;
      drawWrappedText(newsCtx, headline, newsCanvas.width / 2, 800, 900, 60, 'bold', 'Arial', '#006163', 5);
    };
    tempImage.src = canvas.toDataURL();
  });

  // ðŸ‘‡ Function to draw wrapped text with 10% reduced size
  function drawWrappedText(ctx, text, x, y, maxWidth, fontSize, fontWeight, fontFamily, color, shadowOffset) {
    const reducedFontSize = fontSize * 0.9; // Reduce font size by 10%
    ctx.font = `${fontWeight} ${reducedFontSize}px ${fontFamily}`;
    ctx.fillStyle = color;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';
    ctx.shadowColor = 'rgba(0, 97, 99, 0.23)';
    ctx.shadowBlur = 0;
    ctx.shadowOffsetX = shadowOffset;
    ctx.shadowOffsetY = shadowOffset;
    ctx.direction = 'rtl';

    const words = text.split(' ');
    let line = '';
    let lineHeight = reducedFontSize * 1.2;
    let yPos = y;

    for (let i = 0; i < words.length; i++) {
      const testLine = line + words[i] + ' ';
      const metrics = ctx.measureText(testLine);
      const testWidth = metrics.width;

      if (testWidth > maxWidth && i > 0) {
        ctx.fillText(line.trim(), x, yPos);
        line = words[i] + ' ';
        yPos += lineHeight;
      } else {
        line = testLine;
      }
    }
    ctx.fillText(line.trim(), x, yPos);
  }
</script>
</body>
</html>
