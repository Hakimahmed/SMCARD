<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>News Graphic Generator - Final Fixed Version</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Urdu+Najd+V3&display=swap');

  * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Roboto', sans-serif; }
  body { background: #f4f6f8; padding: 30px; color: #333; }
  h1 { text-align: center; margin-bottom: 30px; color: #006163; }
  .container { max-width: 1280px; margin: 0 auto; }
  #canvasContainer, #newsCanvasContainer { background: #fff; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 30px; border: 1px solid #ccc; overflow: hidden; }
  #canvasContainer { width: 1200px; height: 720px; }
  #newsCanvasContainer { width: 1080px; height: 1080px; position: relative; }
  canvas { display: block; margin: auto; }
  .controls { text-align: center; margin-bottom: 30px; }
  button { padding: 12px 24px; margin: 5px; border: none; border-radius: 6px; background: #006163; color: white; font-size: 16px; cursor: pointer; transition: background-color 0.3s ease; }
  button:hover { background: #004d4d; }
  #headlineInput { width: 80%; padding: 12px; font-size: 30px; border: 1px solid #ccc; border-radius: 6px; margin: 20px auto; display: block; font-family: 'Urdu Najd V3', serif; }
  #wordCounter { text-align: center; margin-top: 8px; font-size: 18px; color: #006163; }
  .download-buttons { text-align: center; margin-top: 20px; }
</style>
</head>
<body>
<div class="container">
  <h1>News Graphic Generator</h1>

  <div id="canvasContainer">
    <canvas id="canvas" width="1200" height="720"></canvas>
  </div>

  <div class="controls">
    <input type="text" id="headlineInput" dir="rtl" placeholder="Enter Headline (max 13 words)">
    <div id="wordCounter">Words: 0 / 13</div>
    <button id="generateButton" disabled>Generate News Graphic</button>
  </div>

  <div id="newsCanvasContainer">
    <canvas id="newsCanvas" width="1080" height="1080"></canvas>
  </div>

  <div class="download-buttons">
    <button id="downloadNewsButton">Download News Image</button>
  </div>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const newsCanvas = document.getElementById('newsCanvas');
const newsCtx = newsCanvas.getContext('2d');
const headlineInput = document.getElementById('headlineInput');
const generateButton = document.getElementById('generateButton');
const downloadNewsButton = document.getElementById('downloadNewsButton');
const wordCounter = document.getElementById('wordCounter');

const backgroundImage = new Image();
backgroundImage.src = 'bg.jpg'; // Your background image

const logoImage = new Image();
logoImage.src = 'aaj-logo.png'; // Your logo image

let pastedImage = null;

// Paste image support
window.addEventListener('paste', function(e) {
  const items = e.clipboardData.items;
  for (let item of items) {
    if (item.type.indexOf('image') !== -1) {
      const file = item.getAsFile();
      const reader = new FileReader();
      reader.onload = function(event) {
        pastedImage = new Image();
        pastedImage.onload = function() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(pastedImage, 0, 0, canvas.width, canvas.height);
        }
        pastedImage.src = event.target.result;
      }
      reader.readAsDataURL(file);
    }
  }
});

// Word limit logic
headlineInput.addEventListener('input', function() {
  const words = headlineInput.value.trim().split(/\s+/);
  wordCounter.textContent = `Words: ${words.length} / 13`;
  if (words.length > 13) {
    headlineInput.style.borderColor = 'red';
    generateButton.disabled = true;
  } else {
    headlineInput.style.borderColor = '#ccc';
    generateButton.disabled = words.length === 0;
  }
});

function drawMixedHeadline(ctx, text, centerX, centerY) {
  ctx.textAlign = 'left';
  ctx.textBaseline = 'middle';

  let totalWidth = 0;
  for (let char of text) {
    ctx.font = /\d/.test(char) ? "bold 70px Arial" : "bold 70px 'Urdu Najd V3'";
    totalWidth += ctx.measureText(char).width;
  }

  let currentX = centerX - totalWidth / 2;
  ctx.fillStyle = "#006163";

  for (let char of text) {
    ctx.font = /\d/.test(char) ? "bold 70px Arial" : "bold 70px 'Urdu Najd V3'";
    ctx.fillText(char, currentX, centerY);
    currentX += ctx.measureText(char).width;
  }
}

function generateNewsCanvas() {
  let headline = headlineInput.value;
  if (!headline || !pastedImage) return;

  newsCtx.clearRect(0, 0, newsCanvas.width, newsCanvas.height);
  newsCtx.drawImage(backgroundImage, 0, 0, newsCanvas.width, newsCanvas.height);

  // Draw story image
  newsCtx.drawImage(pastedImage, 0, 0, newsCanvas.width, newsCanvas.height);

  // Draw headline
  drawMixedHeadline(newsCtx, headline, newsCanvas.width / 2, 850);

  // Draw logo
  newsCtx.drawImage(logoImage, 750, 50, 300, 150);
}

generateButton.addEventListener('click', generateNewsCanvas);

downloadNewsButton.addEventListener('click', function() {
  const link = document.createElement('a');
  link.download = 'news-graphic.png';
  link.href = newsCanvas.toDataURL();
  link.click();
});
</script>
</body>
</html>
